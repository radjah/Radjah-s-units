\documentclass[final]{article}
\usepackage[cp1251]{inputenc}
\usepackage[russian]{babel}
\usepackage{graphicx}
\usepackage[colorlinks=true,backref,hidelinks,final]{hyperref}
\usepackage{indentfirst}
\usepackage{enumerate}
\usepackage{keystroke}
%\usepackage[lflt]{floatflt}
%\usepackage{tabularx}
\usepackage{xkeyval}
\hypersetup{pdfauthor=Фролов Павел,
pdftitle=Программный компекс для проведения тягово-энергетических испытаний тепловозов,
pdfdisplaydoctitle=True}

\begin{document}
\title{<<Программный компекс для проведения тягово-энергетических испытаний тепловозов>>\\Руководство по использованию}
\author{Фролов Павел}
\date{\today}
\maketitle
\newpage
\tableofcontents
\newpage
\section{Общие сведения}
\label{sec:general}
\subsection{Цели и задачи}
\label{sec:targ}
Данная комплекс программ служит для упрощения разработки циклов и проведения тягово-энергетических испытания тепловозов.

Основной целью при создании комплекса была переработка существующей программы для проведения испытаний. Существующая программа обладала сильно завышенными системными требованиями для своего класса и не отличалась стабильностью работы.
\subsection{Используемые технологии и системные требования}
\label{sec:descr}
Программs комплекса полностью написана на языке Delphi с использованием бесплатного набора компанентов для работы с базами данных ZEOS DBO.

Комплекс совместим со всеми версиями Microsoft\textregistered{} Windows\textregistered{},начиная Windows\textregistered{}2000. Для работы предпочтительно использовать Windows\textregistered{} XP с установленным SP2 или более новую операционную систему.
\newpage
\section{Установка программы}
\subsection{Описание установщика}
Для удобства пользователя комплекс поставляется в виде установочного пакета\footnote{Для создания пакета использовалась система InstallAware\textregistered{} 9. Для её работы требуется Microsoft\textregistered{} Installer\textregistered{}, который обычно уже присуствует в системе Windows\textregistered{} 2000 и выше.}. Программа установки копирует файлы программы в указанный каталог, создает ярлыки для удобного запуска программы и регистрирует в системе программу для корретного удаления.

Для установки комплекса требуется около 5 Мб свободного места на диске. Программа не вносит никаких изменений в реестр системы и может распространяться простым копированием с сохранением минимального набора файлов (\autoref{sec:minfile}), необходимых для работы программы.
\subsection{Состав комплекса}
\label{sec:progfiles}
В состав программы входят следующие файлы:
\begin{enumerate}[\quad]
\item \textbf{HC.exe} "--- программа для проведения испытаний;
\item \textbf{hceditor.exe} "--- редактор испытательных циклов;
\item \textbf{stages.sqlite} "--- база данных, в которой содержатся готовые циклы и этапы для построения новых циклов;
\item \textbf{CreateDB.exe} "--- программа для создания новой базы данных и обслуживания существующей.
\item \textbf{sqlite3.dll} "--- библиотека дополнительных функций для программы обслуживания базы данных.
\end{enumerate}
\subsection{Минимальный набор файлов}
\label{sec:minfile}
Для проведения испытаний требуется следующий набор набор файлов:
\begin{enumerate}
\item HC.exe
\item один или более hcf-файлов с описанием циклов испытаний.
\end{enumerate}
Для редактирования циклов также потребуются следующие файлы:
\begin{enumerate}
\item hceditor.exe
\item stages.sqlite
\item CreateDB.exe
\item sqlite3.dll
\end{enumerate}

Структура базы данных будет описана в слудующем разделе.
\newpage
\section{Структура базы данных}
База данных содержит 4 таблицы:
\begin{enumerate}
\item cycle
\item cstruct
\item stages
\item sstruct
\end{enumerate}
\subsection{Описание и назначение таблиц}
\subsubsection{Таблица <<cycle>>}
В этой таблице содержится список готовых циклов с наименованиями и идентификаторами для связи с другими таблицами.
Поля таблицы:
\begin{enumerate}
\item \textbf{cid} "--- идентфикатор цикла (целое);
\item \textbf{cname} "--- наименование цикла (строка).
\end{enumerate}
\subsubsection{Таблица <<cstruct>>}
В этой таблице хранится структура всех созданных циклов. Каждая запись связана с одним из определенных циклов и одним из определенных этапов.
Поля таблицы:
\begin{enumerate}
\item \textbf{id} "--- идентфикатор для обеспечения уникальности каждой записи (целое);
\item \textbf{cid} "--- идентификатор цикла для связи записи с созданным циклом (целое);
\item \textbf{corder} "--- порядковый номер этапа в цикле (целое);
\item \textbf{sid} "--- идентификатор этапа для связи записи с определенным этапом (целое).
\end{enumerate}
\subsubsection{Таблица <<stages>>}
В этой таблице содержится список готовых этапов с наименованиями и идентификаторами для связи с другими таблицами.
Поля таблицы:
\begin{enumerate}
\item \textbf{sid} "--- идентфикатор этапа для связи со страктурой этапа и структурами циклов (целое);
\item \textbf{sname} "--- наименование этапа (строка);
\end{enumerate}

\subsubsection{Таблица <<cstruct>>}
В этой таблице хранится структура всех созданных циклов. Каждая запись связана с одним из определенных циклов и одним из определенных этапов.
Поля таблицы:
\begin{enumerate}
\item \textbf{pid} "--- идентфикатор для обеспечения уникальности каждой записи (целое);
\item \textbf{sid} "--- идентификатор этапа для связи записи с созданным этапом (целое);
\item \textbf{clevel} "--- значение позиции контроллера (целое);
\item \textbf{ptime} "--- время работы на указанной позиции (целое);
\item \textbf{porder} "--- порядковый номер указанной позиции в этапе (целое).
\end{enumerate}

\newpage
\section{Работа с программами комплекса}
\label{sec:progs}
\subsection{Программа испытаний}
\label{sec:testprog}
\subsubsection{Окно программы}
\label{sec:testprogwnd}
\begin{figure}[h]
\centering
\includegraphics[width=0.95\textwidth]{testproginterface.png}
\caption{Окно программы.}
\label{fig:testprogwind}
\end{figure}
На рисунке \ref{fig:testprogwind} представлен общий вид окна программы непосредственно после запуска. Файл цикла еще не загружен, поэтому информация о времени позициях не выводится.
\newpage
\subsubsection{Описание элементов интерфейса программы}
Для управления программой используются три кнопки в нижней части окна.

Кнопка \keystroke{Загрузить} используется указания файла с описанием цикла и загрузки информации из него.

Кнопка \keystroke{Поехали!} используется для запуска загруженного цикла.

Кнопка \keystroke{О программе} выводит окно с информацией о версии и авторе программы.

Во время работы программы выводится следующая информация (слева направо и сверху вниз):
\begin{itemize}
    \item Текущая позиция контроллера;
    \item Текущий этап цикла и общее количество этапов;
    \item Следующая позиция контроллера;
    \item Оставшееся время работы на указанной позиции;
    \item Прогресс-бар с наглядным представлением пройденного и оставшегося времени;
    \item Представление цикла в виде зависимости позиции контроллера от времени.
\end{itemize}
\newpage
\subsubsection{Работа с программой}
\label{sec:testprogwork}

Работа с программой состоит из трех этапов:
\begin{enumerate}
    \item Запуск программы;
    \item Загрузка цикла из файла;
    \item Запуск цикла.
\end{enumerate}
Запуск программы осущствеляется с помощью ярлыка в главном меню, яралыка на рабочем столе или запуском непосредственно exe-файла "HC.exe". После запуска на экране отобразится окно как на рисунке \ref{fig:testprogwind}. Кнопка \keystroke{Поехали!} неактивна, потому что цикл испытаний не загружен.

\begin{figure}[h]
\centering
\includegraphics[width=0.95\textwidth]{testprogworkload.png}
\caption{Окно открытия файла с циклом испытаний.}
\label{fig:testprogload}
\end{figure}

Для загрузки цикла из файла надо нажать кнопку \keystroke{Загрузить} и выбрать hcf-файл, содержащий информацию о цикле. (Рис. \ref{fig:testprogload})

После загрузки файла появится сообщение с информацией о загруженном цикле (Рис. \ref{fig:testproginfo}), а само окно программы отобразит начальные условия цикла и его графическое представление (Рис. \ref{fig:testprogready}).

После загрузки цикла можно приступать к испытаниям. Для этого надо нажать кнопку \keystroke{Поехали!}. При этом запустится отсчет времени,отобразится информация о следующей позиции, и график по мере прохождения цикла испытания будет закрашиываться красным цветом. Моменты переключения позиций контроллера программа будет обозначать звуковым сигналом. Выполнение цикла можно остановить закрытием программы.

\begin{figure}
\centering
\includegraphics[width=0.4\textwidth]{testproginfo.png}
\caption{Информация о загруженном цикле.}
\label{fig:testproginfo}
\end{figure}
\begin{figure}[h]
\centering
\includegraphics[width=0.85\textwidth]{testprogwork.png}
\caption{Окно программы после загрузки файла цикла.}
\label{fig:testprogready}
\end{figure}
\begin{figure}
\centering
\includegraphics[width=0.85\textwidth]{testprogworkprogress.png}
\caption{Окно программы во время проведения испытаний.}
\label{fig:testprogworkprogress}
\end{figure}
\newpage
\subsection{Редактор циклов}
\label{sec:editorprog}
\subsubsection{Окно программы}
\label{sec:editprogwind}
\begin{figure}[h]
\centering
\includegraphics[width=0.85\textwidth]{editproginterface.png}
\caption{Окно программы.}
\label{fig:editproginterface}
\end{figure}

На рисунке \ref{fig:editproginterface} представлен общий вид окна редактора циклов с уже созданными циклами.

Окно программы разделено на две функциональные части: список циклов и управляющие кнопки.

Кнопка \keystroke{Создать цикл} запускает процедуру создания нового цикла.

Кнопка \keystroke{Изменить цикл} запускает процедуру редактирования выбранного цикла. Если не задано ни одного цикла, то эта кнопка будет неактивна.

Кнопка \keystroke{Переименовать} запускает процедуру переименования выбранного цикла. Если не задано ни одного цикла, то эта кнопка будет неактивна.

Кнопка \keystroke{Удалить цикл} запускает процедуру удаления выбранного цикла. Если не задано ни одного цикла, то эта кнопка будет неактивна.

Кнопка \keystroke{Просмотр и экспорт} запускает позволяет посмотреть графическое предстваление выбранного цикла и осуществить его экспорт в hcf-файл. Если не задано ни одного цикла, то эта кнопка будет неактивна.

Кнопка \keystroke{Редактор этапов} запускает запускает радактор этапов,из которых можно составить новые циклы.

\newpage
\subsubsection{Работа с программой}
\label{sec:editprogwork}
C помощью программы можно выполнять следующие задачи:
\begin{enumerate}
    \item Проектировать отдельные этапы циклов;
    \item Составлять циклы из зозданных этапов;
    \item Экспортировать готовые циклы в hcf-файлы для проведения по ним испытаний.
\end{enumerate}

Запуск программы осущствеляется с помощью ярлыка в главном меню, яралыка на рабочем столе или запуском непосредственно exe-файла "hceditor.exe.exe". После запуска на экране отобразится окно как на рисунке \ref{fig:editproginterface}. После запуска можно приступать к работе.

Перед созданием нового цикла надо создать один или несколько этапов, из которых он будет состоять. Для этого надо нажать кнопку \keystroke{Редактор этапов}, при этом отобразится окно со списком уже созданных этапов (Рис. \ref{fig:editprogstageeditor}).

В этом окне слева расположен список уже созданных этапов, справа показана информация о составе выбранного этапа, а снизу его графичечкое представление в виде зависимости позиции контроллера от времени.

\begin{figure}[h]
\centering
\includegraphics[width=0.85\textwidth]{editprogstageeditor.png}
\caption{Окно редактора этапов.}
\label{fig:editprogstageeditor}
\end{figure}

Для создания нового этапа необходимо нажать кнопку \keystroke{Создать}. При этом появится окно создания нового этапа (Рис. \ref{fig:editprognewstage}). В этом окне необходимо указать количество переключений, которое должно содержаться в новом этапе и нажать кнопку \keystroke{Задать}. По этой кнопке произойдет создание шаблона нового цикла, в области <<Позиции и их продолжительность в секундах:>> появятся элементы управления для задания параметров нового этапа. (Рис. \ref{fig:editprnewstagefilled})

\begin{figure}[h]\centering
	\parbox[b]{0,49\textwidth}{
		\centering
			\includegraphics[width=0.44\textwidth]{editprnewstage.png}
			\caption{Окно создания нового этапа.}
			\label{fig:editprognewstage}}
			\hfil\hfil
			\begin{minipage}[b]{0,49\textwidth}
				\centering
				\includegraphics[width=0.9\textwidth]{editprnewstagefilled.png}
				\caption{Шаблон нового этапа.}
				\label{fig:editprnewstagefilled}
			\end{minipage}
\end{figure}

Изменить количесво переключений в этапе можно кнопками \keystroke{+1} и \keystroke{-1}. Чтобы полностью пересоздать шаблон цикла, надо заново указать количество переключений и нажать кнопку \keystroke{Задать}, при этом старый шаблон со всеми введенными значениями будет удален.

Разница этих двух способов в том, что при использовании кнопок \keystroke{+1} и \keystroke{-1} происходит изменение существующего шаблона (добавляется или удаляется переключение в конец этапа), и при использовании кнопки \keystroke{Задать} создается новый шаблон с удалением старого.

При использовании кнопок \keystroke{+1} и \keystroke{-1} надо помнить, что в этапе цикла должно содержаться хотя бы одно переключение контроллера. Для предотвращения этого кнопка удаления отклчается, когда количество переключений становится равным одному.

Уже созданные этапы можно отредактировать. Для этого в окне редактора этапов надо выбрать нужный этап из списка и нажать кнопку \keystroke{Изменить}. При этом появится окно радактирования выбранного этапа. (Рис. \ref{fig:editprogeditst})

Для редактирования этапа доступны такие же инструменты, что и при создании нового этапа.

\begin{figure}[h]
\centering
\includegraphics[width=0.45\textwidth]{editprogeditst.png}
\caption{Окно редактора этапов.}
\label{fig:editprogeditst}
\end{figure}

\newpage

Ненужные этапы можно удалить. Для этого надо в окне редактора этапов выбрать этап и нажать кнопку \keystroke{Удалить}. При этом появится запрос на подтверждение удаления. (Рис. \ref{fig:stagedelask}) Если выбранный этап уже задействован хотя бы в одном цикле, то удалить его не получится, о чем сообщит программа. (Рис. \ref{fig:stagedelerr})

\begin{figure}[h]
\centering
\includegraphics[width=0.5\textwidth]{stagedelask.png}
\caption{Запрос на удаление этапа.}
\label{fig:stagedelask}
\end{figure}

\begin{figure}[h]
\centering
\includegraphics[width=0.7\textwidth]{stagedelerr.png}
\caption{Ошибка при удалении этапа.}
\label{fig:stagedelerr}
\end{figure}

\newpage
Для создания нового цикла испытаний надо в главном окне программе \keystroke{Создать цикл}. При этом повится запрос на ввод имени нового этапа. (Рис. \ref{fig:newcycleask}) После ввода имени новый цикл будет создан, и повится окно редактирования этого цикла. (Рис. \ref{fig:cycleeditornew}) Если имя задано некорректно, то программа об этом сообщит. (Рис. \ref{fig:cycledel}) Процедура создания нового цикла при этом прервется.

\begin{figure}[h]
\centering
\includegraphics[width=0.5\textwidth]{newcycleask.png}
\caption{Запрос имени цикла.}
\label{fig:newcycleask}
\end{figure}

\begin{figure}[h]
\centering
\includegraphics[width=0.6\textwidth]{cycledel.png}
\caption{Запрос удаления цикла.}
\label{fig:cycledel}
\end{figure}

\newpage

\begin{figure}[h]
\centering
\includegraphics[width=0.95\textwidth]{cycleeditornew.png}
\caption{Окно редактора нового цикла.}
\label{fig:cycleeditornew}
\end{figure}

Окно редактирования цикла разделено на две части:
\begin{itemize}
    \item Список задействованных этапов;
    \item Список доступных этапов с графическим представлением выбранного этапа.
\end{itemize}

Между этими списками находятся кнопки для управления этапами.

Кнопка \keystroke{<} добавляет выбранный этап из списке доступных в конец цикла.

Кнопка \keystroke{>} удаляет выбранный этап из списке задействованных из цикла.

\newpage
Уже созданные циклы можно так же отредактировать. Для этого в главном окне программы надо выбрать нужный цикл из списка созданных и нажать кнопку \keystroke{Изменить цикл}. При этом появится окно редактирования цикла. (Рис. \ref{fig:cycleeditor}) 

Для редактирования цикла доступны такие же инструменты, что и при создании нового цикла.

\begin{figure}[h]
\centering
\includegraphics[width=0.95\textwidth]{cycleeditor.png}
\caption{Окно редактора цикла.}
\label{fig:cycleeditor}
\end{figure}
\newpage
После создания существующий цикл можно переименовать. Для этого надо в главном окне выбрать нужный цикл и нажать кнопку \keystroke{Переименовать}. При этом появится запрос на изменение названия цикла. (Рис. \ref{fig:cyclerename}) Если имя задано некорректно, то программа об этом сообщит. (Рис. \ref{fig:cycledel}) Процедура переименования цикла при этом прервется.

\begin{figure}[h]
\centering
\includegraphics[width=0.5\textwidth]{cyclerename.png}
\caption{Запрос переименования цикла.}
\label{fig:cyclerename}
\end{figure}
\newpage
\subsection{Программа обслуживания базы}
\label{sec:dbmprog}
\subsubsection{Окно программы}
\label{sec:dbmprogwnd}

\begin{figure}[h]
\centering
\includegraphics[width=0.95\textwidth]{dbm.png}
\caption{Окно программы.}
\label{fig:dbm}
\end{figure}

Главное окно программы лочиески рзделено на две части:
\begin{itemize}
    \item Обслуживание структуры базы --- верхняя часть;
    \item Работа с содержимым базы --- нижняя часть.
\end{itemize}

\subsubsection{Описание элементов интерфейса}
\label{sec:dbmprogctrls}

Кнопка \keystroke{Создать базу} запускает процедуру создания нового файла базы данных.

Кнопка \keystroke{Оптимизировать базу} позволяет оптимизировать существующую базу данных.

Кнопка \keystroke{О программе} - вывод информации о версии и авторе программы.

Группа <<Работа с существующей базой>>

Кнопка \keystroke{Открыть базу} - открытие существующей базы.

Кнопка \keystroke{Закрыть базу} - закончить работу с открытой ранее базой.

В поле <<SQL-запрос:>> вводится запрос на языке SQL.

В поле <<Результат:>> выводится результат запроса, если он возвращает массив данных.

Кнопки \keystroke{Open} и \keystroke{ExecSQL} отвечают за выполнение запроса из поля <<SQL-запрос:>>. Рзличие в их работе будет описано в следующем разделе.

\subsubsection{Работа с программой}
\label{sec:dbmprogwork}

Для создания новой базы данных надо нажать кнопку \keystroke{Создать базу}. При этом появится запрос способа создания базы. (Рис. \ref{fig:dbmcreate})

Файл базы данных может быть создан в папке с программой. Этот способ обычно используется, если база данных еще не создана. Для создания базы таким способом надо в окне запроса нажать кнопку \keystroke{Да}.

\textbf{ВНИМАНИЕ!} Если в папке программы уже существует база данных, то её содержимое будет удалено, а структура создана заново.

Чтобы самостоятельно указать путь до новой базы и имя файла надо нажать кнопку \keystroke{Да}. При этом появится диалоговое окно сохранения файла.

Для прерывания процедуры создания базы надо нажать кнопку \keystroke{Отмена}.

\begin{figure}[h]
\centering
\includegraphics[width=0.6\textwidth]{dbmcreate.png}
\caption{Запрос переименования цикла.}
\label{fig:dbmcreate}
\end{figure}

При подтверждении запроса на создание базы данных начнутся процедура построения, в конце которой в случае успеха появится сообщение об успешном окончании процесса. (Рис. \ref{fig:dbmcreatefin})

\begin{figure}[h]
\centering
\includegraphics[width=0.8\textwidth]{dbmcreatefin.png}
\caption{Сообщение.}
\label{fig:dbmcreatefin}
\end{figure}

При длительной работе с редактором циклов структура базы данных становится неоптимальной. Врезультате в базе накапливается мусор и несвязанные данных, что замедляет её работу и можетпривести к ошибкам.

Для оптимизации структуры базы данных и удаления мусора и несвязанных данных надо нажать кнопку \keystroke{Оптимизировать базу}. При этом появится диалоговое окно выбора файла базы данных. Вэтом окне надо указать путь к существующей базе данных. После подтверждения выбора файла начнется процедура оптимизации, в конце которой повится сообщение об окончании всех операций. (Рис. \ref{fig:dbmopt})

\begin{figure}[h]
\centering
\includegraphics[width=0.5\textwidth]{dbmopt.png}
\caption{Сообщение.}
\label{fig:dbmopt}
\end{figure}

Для того, чтобы начать обслуживание содержимого существующей базы данных надо выполнить ряд подготовительных действий.

Для начала надо нажать кнопку \keystroke{Открыть базу}. При этомпоявится дилоговое окно открытия файла, в котором надо указать путь и имя файла существующей базы. Вслучае успешного открытия базы данных программа сообщит об этом. (Рис. \ref{fig:dbmopen})

\begin{figure}[h]
\centering
\includegraphics[width=0.6\textwidth]{dbmopen.png}
\caption{Сообщение.}
\label{fig:dbmopen}
\end{figure}

После открытия базы данных можно вводить и выполнять SQL-запросы к ней. Для этого надо ввести в поле <<SQL-запрос:>> сам запрос и нажать на однц из кнопок.

Кнопка \keystroke{Open} используется, если результатом запроса должен стать набор данных, которых необходимо просмотреть. При этом будет выполнен запрос сформирован набор данных. Полученный набор будет выведен в таблицу <<Результат:>>. После всех действий программа сообщит о результате. (Рис. \ref{fig:dbmopends})

Кнопка \keystroke{ExecSQL} используется, если результатом запроса должно быть некое действие над структурой базы, например, удаление или добавление записей. При этом программа выполнит запрос к базе данных и выведет сообщение о результате. (Рис. \ref{fig:dbmexecsql})

\begin{figure}[h]
\centering
\includegraphics[width=0.6\textwidth]{dbmopends.png}
\caption{Сообщение по кнопке <<Open>>.}
\label{fig:dbmopends}
\end{figure}

\begin{figure}[h]
\centering
\includegraphics[width=0.5\textwidth]{dbmexecsql.png}
\caption{Сообщение по кнопке <<ExecSQL>>.}
\label{fig:dbmexecsql}
\end{figure}

После проведения всех необходимых операций надо завершить работу с базой данных и закрыть её. Для этого надо нажать кнопку \keystroke{Закрыть базу}. При этом программа корректно закроет базу и выведет сообщение о результате. (Рис. \ref{fig:dbmclose})

\begin{figure}[h]
\centering
\includegraphics[width=0.5\textwidth]{dbmclose.png}
\caption{Сообщение.}
\label{fig:dbmclose}
\end{figure}

\newpage
\section{Информация об авторе и поддержке}
\label{sec:author}
Автор программы: Фролов Павел (\url{http://radjik.blogspot.com})

По вопросам поддержки, обновления и получения исходных текстов обращаться лично или по адресу \url{mailto:radjah@ya.su}.

Программа не содержит ГМО. При её разработке не пострадало ни одно животное.

Автор не исключает появление жертв при внедрении программы в производство.
\end{document}
